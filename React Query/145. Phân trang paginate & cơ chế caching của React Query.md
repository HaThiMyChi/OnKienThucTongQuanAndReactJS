## Đây là Docs tự research:

## Cách phân trang và tối ưu UX với React Query ?

- Để phân trang và tối ưu trải nghiệm người dùng (UX) với React Query, bạn có thể sử dụng các tính năng và cơ chế của nó như pagination và caching. Dưới đây là các bước cơ bản để thực hiện phân trang và tối ưu UX với React Query:

1. `Lấy dữ liệu theo trang:` Sử dụng React Query để lấy dữ liệu từ API theo từng trang. Bạn có thể sử dụng `queryFn` để gọi API và truyền tham số trang (ví dụ: page, limit) dể chỉ định dữ liệu cần lấy.

2. `Sử dụng cache và stale time:` Sử dụng cache của React Query để lưu trữ dữ liệu đã lấy từ API trước đó. Đặt thời gian `stale` (thời gian hết hạn) phù hợp để kiểm soát thời gian `cache` dữ liệu. Khi người dùng chuyển trang và yêu cầu dữ liệu mới, React Query sẽ sử dụng dữ liệu `cache` trước khi gửi yêu cầu tới `server`, tối ưu hóa thời gian phản hồi và giảm tải cho `server`.

3. `Sử dụng pagination và scroll loading:` Đối với danh sách dữ liệu lớn, bạn có thể sử dụng `pagination` để hiển thị từng trang dữ liệu. React Query cung cấp các tùy chọn như `offset`, `limit`, hoặc `cursor` để định rõ các trang dữ liệu. Bạn có thể sử dụng các thành phần UI như nút `trang trước` và `trang tiếp` để điều hướng giữa các trang. Ngoài ra, bạn cũng có thể sử dụng `scroll loading` để tự động tải thêm dữ liệu khi người dùng cuộn đến cuối danh sách.

4. `Xử lý trạng thái loading và error`: Khi lấy dữ liệu mới hoặc chuyển trang, sử dụng trạng thái `loading` để hiển thị thông báo hoặc biểu tượng cho người dùng biết rằng dữ liệu đang được tải. Nếu có lỗi xảy ra, hiển thị thông báo lỗi hoặc cho phép người dùng thử lại. React Query cung cấp các trang như `isLoading`, `isError` để giúp bạn xử lý các trạng thái này một cách dễ dàng.

5. `Tùy chỉnh UI và tương tác:` Sử dụng các thư viện UI hoặc tự thiết kế UI để tạo giao diện phân trang và hiển thị dữ liệu. React Query không định sẵn giao diện, cho phép bạn tùy chỉnh và tích hợp các thành phần UI khác theo ý muốn.

Tóm lại, React Query cung cấp các tính năng và cơ chế để phân trang và tối ưu UX khi làm việc với dữ liệu. Bằng cách sử dụng `cache`, `pagination` và các trạng thái của React Query, bạn có thể cung cấp trải nghiệm người dùng tốt hơn khi làm việc với danh sách dữ liệu lớn.

## ❌❌ Lưu ý:

- `invalidateQueries` làm mới tất cả các truy vấn có tên `posts`, trong khi `invalidateQuery` chỉ làm mới truy vấn `posts` cụ thể.
- `invalidateQueries` nó nhận một khóa truy vấn hoặc một mảng các khóa truy vấn làm đối số `invalidateQueries` các truy vấn được liên kết với các khóa đó. Điều này có thể hữu ích khi có nhiều truy vấn phụ thuộc vào cùng một dữ liệu và bạn muốn `invalidateQueries`.

- ❌❌ Nhưng trong Docs của React Query thì chỉ có `invalidateQueries` thôi. Không có `invalidateQuery`. Nhớ nhé !!

## Cơ chế phân trang trong React Query?

- Cơ chế phân trang trong React Query là một cách để hiển thị dữ liệu trang web theo từng trang nhỏ, giúp tối ưu hóa hiệu suất và cải thiện trải nghiệm người dùng khi làm việc với tập dữ liệu lớn.

- Cách thức hoạt động của cơ chế phân trang trong React Query thường được thực hiện như sau:

1. `Truy vấn ban đầu:` Bạn thực hiện một truy vấn ban đầu để lấy dữ liệu trang đầu tiên từ server. Bạn có thể sử dụng hook `useQuery` để thực hiện truy vấn này.

2. `Lưu trữ và hiển thị dữ liệu:` Khi dữ liệu được trả về từ server, React Query sẽ lưu trữ nó trong bộ cache. Bạn có thể sử dụng các state và hàm cung cấp bỏi React Query để truy vấn và hiển thị dữ liệu này trong giao diện người dùng.

3. `Chuyển đổi trang:` Khi người dùng chuyển đổi sang trang tiếp theo hoặc trang trước đó, bạn có thể sử dụng các tham số trong truy vấn (như số trang, kích thước trang, vị trí bắt đầu...) để xác định dữ liệu cần lấy từ cache hoặc gửi yêu cầu mới đến server.

4. `Fetch dữ liệu mới:` Nếu dữ liệu cần hiển thị không có trong cache hoặc đã hết hạn, React Query sẽ tự động gửi yêu cầu mới đến server để lấy dữ liệu mới. Bạn có thể sử dụng hook `useQuery` và cung cấp các tham số như `query key` và `query function` để thực hiện việc này.

5. `Cập nhật và hiển thị dữ liệu mới:` Khi dữ liệu mới được trả về từ server, React Query sẽ cập nhật nó trong cache và tự động cập nhật giao diện người dùng để hiển thị dữ liệu mới. Bạn có thể sử dụng các state và hàm cung cấp bởi React Query để truy xuất và hiển thị dữ liệu mới này.

- Cơ chế phân trang trong React Query giúp bạn quản lý dữ liệu phân trang một cách dễ dàng và hiệu quả. Nó cung cấp các công cụ và tính năng để truy xuất và cập nhật dữ liệu phân trang, đồng thời giảm tải cho server và tăng tốc độ hiển thị dữ liệu cho người dùng.

## Có nghĩa là lần đầu nó lấy tất cả các data từ server, xong sau đó nó chia nhỏ ra từng trang và render data ra hả ?

- Đúng, cơ chế phân trang trong React Query thường bắt đầu bằng việc lấy tất cả dữ liệu từ server trong lần truy vấn ban đầu. Sau đó, dữ liệu này được chia nhỏ thành các trang để hiển thị và truy cập dễ dàng.

- Khi dữ liệu đã được lấy về, React Query sẽ lưu trữ nó trong cache để có thể sử dụng lại mà không cần gửi yêu cầu mới đến server. Mỗi trang dữ liệu sẽ được lưu trữ trong cache với một key duy nhất tương ứng với các tham số phân trang, như số trang, kích thước trang, vị trí bắt đầu...

- Khi người dùng chuyển đổi giữa các trang, React Query sẽ dựa vào các tham số phân trang để xác định dữ liệu cần hiển thị. Nếu dữ liệu đã tồn tại trong cache và chưa hết hạn (stale), React Query sẽ trực tiếp lấy dữ liệu từ cache và hiển thị. Điều này giúp cải thiện trải nghiệm người dùng vì dữ liệu được lấy nhanh chóng từ bộ nhớ cache mà không cần gửi yêu cầu tới server.

- Nếu dữ liệu không có trong cache hoặc đã hết hạn, React Query sẽ tự động gửi yêu cầu mới đến server để lấy dữ liệu mới. Sau khi nhận được dữ liệu từ server, React Query cập nhật lại cache và hiển thị dữ liệu mới lên giao diện người dùng.

- Với cơ chế phân trang của React Query, bạn có thể quản lý dữ liệu phân trang một cách dễ dàng và hiệu quả, đồng thời tối ưu hóa trải nghiệm người dùng bằng cách lấy dữ liệu nhanh chóng từ cache và chỉ gửi yêu cầu mới khi cần thiết.

## Cải thiện UX phân trang với `keepPreviousData` trong React Query?

- Để cải thiện trải nghiệm người dùng khi phân trang dữ liệu trong React Query, ta có thể sử dụng tùy chọn `keepPreviousData`. Tùy chọn này cho phép giữ lại dữ liệu trang trước khi truy vấn trang mới, giúp tránh việc hiển thị một giao diện trống trải nghiệm người dùng khi đang chờ dữ liệu mới được trả về từ server.

- Khi chúng ta chuyển sang trang mới, React Query sẽ tự động gửi yêu cầu truy vấn để lấy dữ liệu mới. Trong quá trình này, khi dữ liệu mới chưa được trả về, chúng ta có thể sử dụng dữ liệu trang trước (`dữ liệu từ cache`) để hiển thị lên giao diện. Điều này giúp duy trì giao diện không bị trống và cho phép người dùng tiếp tục tương tác (`interact`) với dữ liệu đã hiển thị.

- Để sử dụng `keepPreviousData`, chúng ta cần thêm tùy chọn này vào hook `useQuery`:

```jsx
const queryOptions = {
  keepPreviousData: true,
};

const { data, isLoading, isError } = useQuery(queryKey, queryFn, queryOptions);
```

- Khi `keepPreviousData` được đặt thành `true`, biến `data` sẽ giữ lại giá trị của dữ liệu trang trước trong quá trình truy vấn dữ liệu mới. Khi dữ liệu mới được trả về, biến `data` sẽ được cập nhật với dữ liệu mới nhất từ `server`.

- Với `keepPreviousData`, người dùng sẽ nhận thấy rằng giao diện không bị trống trong quá trình chuyển đổi và có thể tiếp tục tương tác với dữ liệu đã hiển thị. Điều này cải thiện trải nghiệm người dùng và giúp ứng dụng trở nên linh hoạt và thân thiện hơn khi làm việc với dữ liệu phân trang.

## Tóm lại khi phân trang và sử dụng cơ chế Caching trong React Query ?

- Khi phân trang và sử dụng cơ chế Caching trong React Query, ta có thể tóm lại như sau:

- `Phân trang:` React Query cung cấp cơ chế phân trang mạnh mẽ để lấy và hiển thị dữ liệu phân trang từ `server`. Ta có thể sử dụng các tùy chọn như `page`, `pageSize`, `offset`,... để chỉ định các thông số phân trang và gửi yêu cầu truy vấn tương ứng để lấy dữ liệu từ `server`.

- `Caching:` React Query tự động lưu trữ dữ liệu vào cache để tái sử dụng và cải thiện hiệu năng. Khi ta truy vấn dữ liệu từ `server`, React Query sẽ tự động lưu trữ kết quả vào cache và duy trì nó trong một khoảng thời gian nhất định. Khi ta tiếp tục truy vấn dữ liệu trang tiếp theo, React Query sẽ kiểm tra cache trước, nếu có dữ liệu trong cache và chưa hết hạn, nó sẽ trả về dữ liệu từ cache thay vì gửi yêu cầu mới đến `server`.

- `Tối ưu UX:` React Query cung cấp các tùy chọn và khả năng để tối ưu trải nghiệm người dùng khi phân trang. Ta có thể sử dụng `keepPreviousData` để giữ lại dữ liệu trang trước khi truy vấn dữ liệu mới, giúp tránh hiển thị giao diện trống khi đang chờ dữ liệu mới. Ta cũng có thể sử dụng `suspense` và `useIsFetching` để hiển thị các trạng thái báo tải dữ liệu và cải thiện UX trong quá trình truy vấn và cập nhật dữ liệu.

- Tổng quan, React Query cung cấp các công cụ và khả năng mạnh mẽ để xử lý phân trang và tận dụng cơ chế `Caching` để cải thiện hiệu suất và trải nghiệm người dùng trong ứng dụng React. Việc sử dụng các tính năng này giúp ta dễ dàng làm việc với dữ liệu phân trang, giảm thời gian và công sức phát triển, và mang lại trải nghiệm tốt hơn cho người dùng.
